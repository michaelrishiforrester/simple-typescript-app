{
    "SampleEventData": {
      "ConfigRuleComplianceChangeEvent": {
        "version": "0",
        "id": "12345678-1234-1234-1234-123456789012",
        "detail-type": "Config Rules Compliance Change",
        "source": "aws.config",
        "account": "123456789012",
        "time": "2023-04-13T16:28:45Z",
        "region": "us-east-1",
        "resources": [
          "arn:aws:ec2:us-east-1:123456789012:instance/i-0123456789abcdef0"
        ],
        "detail": {
          "resourceId": "i-0123456789abcdef0",
          "resourceType": "AWS::EC2::Instance",
          "configRuleName": "ec2-managedinstance-patch-compliance-status-check",
          "awsAccountId": "123456789012",
          "configRuleARN": "arn:aws:config:us-east-1:123456789012:config-rule/config-rule-abcdef",
          "newEvaluationResult": {
            "evaluationResultIdentifier": {
              "evaluationResultQualifier": {
                "configRuleName": "ec2-managedinstance-patch-compliance-status-check",
                "resourceType": "AWS::EC2::Instance",
                "resourceId": "i-0123456789abcdef0"
              },
              "orderingTimestamp": "2023-04-13T16:28:00.000Z"
            },
            "complianceType": "NON_COMPLIANT",
            "resultRecordedTime": "2023-04-13T16:28:30.000Z",
            "configRuleInvokedTime": "2023-04-13T16:28:15.000Z",
            "annotation": "The instance is missing critical security patches."
          },
          "oldEvaluationResult": {
            "evaluationResultIdentifier": {
              "evaluationResultQualifier": {
                "configRuleName": "ec2-managedinstance-patch-compliance-status-check",
                "resourceType": "AWS::EC2::Instance",
                "resourceId": "i-0123456789abcdef0"
              },
              "orderingTimestamp": "2023-04-13T12:28:00.000Z"
            },
            "complianceType": "COMPLIANT",
            "resultRecordedTime": "2023-04-13T12:28:30.000Z",
            "configRuleInvokedTime": "2023-04-13T12:28:15.000Z"
          }
        }
      }
    },
    "SampleSSMResponses": {
      "DescribeInstanceInformation": {
        "InstanceInformationList": [
          {
            "InstanceId": "i-0123456789abcdef0",
            "PingStatus": "Online",
            "LastPingDateTime": "2023-04-13T16:30:15.000Z",
            "AgentVersion": "3.0.1124.0",
            "IsLatestVersion": true,
            "PlatformType": "Linux",
            "PlatformName": "Amazon Linux",
            "PlatformVersion": "2",
            "ResourceType": "EC2Instance",
            "IPAddress": "10.0.1.15",
            "ComputerName": "ip-10-0-1-15.ec2.internal"
          }
        ]
      },
      "DescribeInstancePatchStates": {
        "InstancePatchStates": [
          {
            "InstanceId": "i-0123456789abcdef0",
            "PatchGroup": "",
            "BaselineId": "pb-0123456789abcdef0",
            "SnapshotId": "12345678-1234-1234-1234-123456789012",
            "OwnerInformation": "",
            "InstalledCount": 247,
            "InstalledOtherCount": 8,
            "InstalledPendingRebootCount": 0,
            "InstalledRejectedCount": 0,
            "MissingCount": 3,
            "FailedCount": 0,
            "NotApplicableCount": 325,
            "Operation": "Scan",
            "OperationStartTime": "2023-04-13T16:28:00.000Z",
            "OperationEndTime": "2023-04-13T16:28:20.000Z",
            "RebootOption": "NoReboot",
            "LastNoRebootInstallOperationTime": "2023-04-12T23:15:14.000Z"
          }
        ]
      },
      "DescribeInstancePatches": {
        "Patches": [
          {
            "Title": "kernel security update",
            "KBId": "ALAS2-2023-123",
            "Classification": "Security",
            "Severity": "Critical",
            "State": "Missing",
            "InstalledTime": ""
          },
          {
            "Title": "openssl security update",
            "KBId": "ALAS2-2023-456",
            "Classification": "Security",
            "Severity": "Important",
            "State": "Missing",
            "InstalledTime": ""
          },
          {
            "Title": "bash security update",
            "KBId": "ALAS2-2023-789",
            "Classification": "Security",
            "Severity": "Medium",
            "State": "Missing",
            "InstalledTime": ""
          }
        ]
      },
      "StartAutomationExecution": {
        "AutomationExecutionId": "12345678-1234-1234-1234-123456789012"
      },
      "DescribeAutomationExecutions": {
        "AutomationExecutions": [
          {
            "AutomationExecutionId": "12345678-1234-1234-1234-123456789012",
            "DocumentName": "AWS-RunPatchBaseline",
            "DocumentVersion": "1",
            "ExecutionStartTime": "2023-04-13T16:32:00.000Z",
            "ExecutionEndTime": "2023-04-13T16:42:15.000Z",
            "AutomationExecutionStatus": "Success",
            "StepExecutions": [
              {
                "StepName": "StartInstallPatches",
                "Action": "aws:runCommand",
                "ExecutionStartTime": "2023-04-13T16:32:05.000Z",
                "ExecutionEndTime": "2023-04-13T16:42:10.000Z",
                "StepStatus": "Success",
                "Outputs": {
                  "CommandId": ["12345678-1234-1234-1234-123456789012"]
                }
              }
            ],
            "Target": "i-0123456789abcdef0",
            "TargetParameterName": "InstanceIds",
            "Targets": [
              {
                "Key": "InstanceIds",
                "Values": ["i-0123456789abcdef0"]
              }
            ],
            "ResolvedTargets": {
              "ParameterValues": ["i-0123456789abcdef0"],
              "Truncated": false
            },
            "AutomationType": "CrossAccount",
            "AlarmConfiguration": {
              "Alarms": []
            },
            "MaxConcurrency": "1",
            "MaxErrors": "1"
          }
        ]
      }
    },
    "SampleEventBridgeRule": {
      "Name": "PatchDriftCatcher",
      "Arn": "arn:aws:events:us-east-1:123456789012:rule/PatchDriftCatcher",
      "EventPattern": "{\"source\":[\"aws.config\"],\"detail-type\":[\"Config Rules Compliance Change\"],\"detail\":{\"configRuleName\":[\"ec2-managedinstance-patch-compliance-status-check\"],\"newEvaluationResult\":{\"complianceType\":[\"NON_COMPLIANT\"]},\"resourceType\":[\"AWS::EC2::Instance\"]}}",
      "State": "ENABLED",
      "Description": "Detects when an EC2 instance becomes non-compliant with the patch baseline",
      "Targets": [
        {
          "Id": "SSMAutomationTarget",
          "Arn": "arn:aws:ssm:us-east-1:123456789012:automation-definition/AWS-RunPatchBaseline:$DEFAULT",
          "RoleArn": "arn:aws:iam::123456789012:role/EventBridgeRole",
          "InputTransformer": {
            "InputPathsMap": {
              "instanceId": "$.detail.resourceId"
            },
            "InputTemplate": "{\"Parameters\":{\"InstanceIds\":[\"<instanceId>\"],\"Operation\":[\"Install\"]},\"AutomationAssumeRole\":[\"arn:aws:iam::123456789012:role/SSMAutomationRole\"]}"
          }
        },
        {
          "Id": "SNSTarget",
          "Arn": "arn:aws:sns:us-east-1:123456789012:PatchDoneAlerts",
          "RoleArn": "arn:aws:iam::123456789012:role/EventBridgeRole",
          "InputTransformer": {
            "InputPathsMap": {
              "instanceId": "$.detail.resourceId"
            },
            "InputTemplate": "\"Patch automation started for instance <instanceId>\""
          }
        },
        {
          "Id": "LambdaTarget",
          "Arn": "arn:aws:lambda:us-east-1:123456789012:function:PatchLogger"
        }
      ]
    },
    "SampleSNSMessage": {
      "Type": "Notification",
      "MessageId": "12345678-1234-1234-1234-123456789012",
      "TopicArn": "arn:aws:sns:us-east-1:123456789012:PatchDoneAlerts",
      "Subject": null,
      "Message": "Patch automation started for instance i-0123456789abcdef0",
      "Timestamp": "2023-04-13T16:32:00.000Z",
      "SignatureVersion": "1",
      "Signature": "EXAMPLE",
      "SigningCertURL": "https://sns.us-east-1.amazonaws.com/SimpleNotificationService-12345.pem",
      "UnsubscribeURL": "https://sns.us-east-1.amazonaws.com/?Action=Unsubscribe&SubscriptionArn=arn:aws:sns:us-east-1:123456789012:PatchDoneAlerts:12345678-1234-1234-1234-123456789012"
    },
    "SampleLambdaEvent": {
      "version": "0",
      "id": "12345678-1234-1234-1234-123456789012",
      "detail-type": "Config Rules Compliance Change",
      "source": "aws.config",
      "account": "123456789012",
      "time": "2023-04-13T16:28:45Z",
      "region": "us-east-1",
      "resources": [
        "arn:aws:ec2:us-east-1:123456789012:instance/i-0123456789abcdef0"
      ],
      "detail": {
        "resourceId": "i-0123456789abcdef0",
        "resourceType": "AWS::EC2::Instance",
        "configRuleName": "ec2-managedinstance-patch-compliance-status-check",
        "awsAccountId": "123456789012",
        "configRuleARN": "arn:aws:config:us-east-1:123456789012:config-rule/config-rule-abcdef",
        "newEvaluationResult": {
          "evaluationResultIdentifier": {
            "evaluationResultQualifier": {
              "configRuleName": "ec2-managedinstance-patch-compliance-status-check",
              "resourceType": "AWS::EC2::Instance",
              "resourceId": "i-0123456789abcdef0"
            },
            "orderingTimestamp": "2023-04-13T16:28:00.000Z"
          },
          "complianceType": "NON_COMPLIANT",
          "resultRecordedTime": "2023-04-13T16:28:30.000Z",
          "configRuleInvokedTime": "2023-04-13T16:28:15.000Z",
          "annotation": "The instance is missing critical security patches."
        },
        "oldEvaluationResult": {
          "evaluationResultIdentifier": {
            "evaluationResultQualifier": {
              "configRuleName": "ec2-managedinstance-patch-compliance-status-check",
              "resourceType": "AWS::EC2::Instance",
              "resourceId": "i-0123456789abcdef0"
            },
            "orderingTimestamp": "2023-04-13T12:28:00.000Z"
          },
          "complianceType": "COMPLIANT",
          "resultRecordedTime": "2023-04-13T12:28:30.000Z",
          "configRuleInvokedTime": "2023-04-13T12:28:15.000Z"
        }
      }
    }
  }
  